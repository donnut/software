
The mechanisms of the Translation Project
-----------------------------------------

This README briefly describes how things are set up on the server of the
Translation Project.


Website
-------

To make the server produce the static and dynamic web pages, Apache is
configured in /etc/apache2/sites-available/www.translationproject.org
like this:

    <VirtualHost *>
        DocumentRoot /home/translation/site
        ServerName www.translationproject.org
        ScriptAlias /registry.cgi /home/translation/site/registry.cgi
    </VirtualHost>

The ScriptAlias allows the execution of the registry.cgi script. This scipt
produces the dynamic pages that contain information about a domain or a team.

The static pages are produced by running 'make' in ~/progs/web; the source
for most of these pages is located in ~/progs/doc.


PO statistics
-------------

A 'crontab' entry ... [which one precisely] ... causes the file
/home/translation/cache/postats to be recalculated every night.
[This should later be changed to on-every-submission.]
This file contains most of the data needed to produce domain and team pages.


The robot
---------

The user 'tp', that receives all mail sent to <*@translationproject.org>, has
the following lines in its '.procmail' file:

  :0:
  * ^TO:robot
  bot-queue

  :0:
  * ^Subject: *[Tt][Pp][-_ ][Rr]obot
  bot-queue

Those rules filter all mail that is meant for the robot to the 'tpr-queue'
mailbox.  To handle this queue, the 'tp' user has this 'crontab' entry:

  0-50/10 * * * *	/bin/sh /home/tp/progs/bin/run-queue.sh

This runs the run-queue.sh every ten minutes.  That script is what actually
launches the robot for each received file.

[This could be changed to handle mail directly, upon receipt,
if things can be locked correctly.]
[Probably the robot also needs to be prevented form running when an admin is
busy editing registry.sgml or anything else in /home/translation?]


Adding a new POT file
---------------------

When package maintainers submit the URL of a new version of their package,
a TP admin cd's to progs/registry, edits the registry.sgml file to update
the <url> field of that package, runs 'make' in that dir (to create a digest
in ~/cache/), and then runs 'fetch-pot $DOMAIN'.  If that succeeds, which it
normally should, she runs 'po-register $DOMAIN-$VERSION.pot' -- this runs
'msgmerge' with the new POT on the most recent PO file for each language,
sends out notifications of the newly created PO files to the teams and to
the last translators, and sends a confirmation to the maintainer.


Changing translator details
---------------------------

When a translator takes on a new package, or a new translator has joined a
team, a TP admin cd's to progs/registry and edits registry.sgml, to adds or
change the required tags.  After that she runs 'make' in that directory to
update the digest of this file in ~/cache/.


If anything is missing from this file, please report it to
<comments@tranlationproject.org>.
